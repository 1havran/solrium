<!--
%\VignetteEngine{knitr::knitr}
%\VignetteIndexEntry{Solr document management}
%\VignetteEncoding{UTF-8}
-->

```{r, echo=FALSE}
knitr::opts_chunk$set(
  comment = "#>",
  collapse = TRUE,
  warning = FALSE,
  message = FALSE
)
```

Solr document management
=======================

## Installation

Stable version from CRAN

```{r eval=FALSE}
install.packages("solr")
```

Or the development version from GitHub

```{r, eval=FALSE}
install.packages("devtools")
devtools::install_github("ropensci/solr")
```

Load

```{r}
library("solr")
```

## Create documents

### From R objects

For now, only lists and data.frame's supported.

#### data.frame

```{r}
file <- system.file("examples", "books.csv", package = "solr")
x <- read.csv(file)
class(x)
head(x)
add(x)
```

#### list

```{r echo=FALSE}
delete_by_id(1:2)
```

```{r}
ss <- list(list(id = 1, price = 100), list(id = 2, price = 500))
add(ss)
```

### From files

#### CSV

```{r}
mtcars <- data.frame(id = 1:NROW(mtcars), mtcars)
write.csv(mtcars[,1:3], file = "~/mtcars.csv", row.names = FALSE, quote = FALSE)
update_csv(files = "~/mtcars.csv")
```

#### JSON

```{r}
file <- system.file("examples", "books2.json", package = "solr")
update_json(file)
```

#### XML

```{r}
file <- system.file("examples", "books2.xml", package = "solr")
update_xml(file)
```

## Delete documents

### By id

Add some documents first

```{r echo=FALSE}
delete_by_id(1:3)
```

```{r}
docs <- list(list(id = 1, price = 100, name = "brown"), 
             list(id = 2, price = 500, name = "blue"),
             list(id = 3, price = 2000L, name = "pink"))
add(docs)
```

And the documents are now in your Solr database

```{r}
tail(solr_search("*:*", base = "http://localhost:8983/solr/select", rows = 100))
```

Now delete those documents just added

```{r deleteid}
delete_by_id(ids = c(1, 2, 3))
```

And now they are gone

```{r}
tail(solr_search("*:*", base = "http://localhost:8983/solr/select", rows = 100))
```

### By query

Add some documents first

```{r}
add(docs)
```

And the documents are now in your Solr database

```{r}
tail(solr_search("*:*", base = "http://localhost:8983/solr/select", rows = 100))
```

Now delete those documents just added

```{r deletequery}
delete_by_query(query = "(name:blue OR name:pink)")
```

And now they are gone

```{r}
tail(solr_search("*:*", base = "http://localhost:8983/solr/select", rows = 100))
```

## Update documents from files

This approach is best if you have many different things you want to do at once, e.g., delete and add files and set any additional options. The functions are:

* `update_xml()`
* `update_json()`
* `update_csv()`

There are separate functions for each of the data types as they take slightly different parameters - and to make it more clear that those are the three input options for data types. 

### from XML

```{r}

```

